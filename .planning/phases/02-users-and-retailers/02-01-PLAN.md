# Plan 02-01: Shared Data Table & Entity Detail Components

## Context

Phase 2 needs reusable components for list pages (DataTable) and detail pages (EntityDetailHeader). These must be built first since both the user and retailer features depend on them. TanStack Table is not yet installed, and shadcn's `table.tsx` primitive is missing.

## Dependencies

- Phase 01-02: StatusBadge, CopyButton, PageHeader, EmptyState, LoadingState, ErrorState
- Phase 01-03: API client (`src/lib/api-client.ts`)

## Requirements Addressed

- LIST-01, LIST-02 (partial): Sortable columns infrastructure
- LIST-05 (partial): Filter infrastructure
- LIST-06: Server-side pagination support
- DETL-05: Status badges (already built, this plan wires them into table cells)
- DETL-06 (partial): CopyButton already built, this plan creates CopyableField wrapper

## Tasks

### Task 1: Install TanStack Table and add shadcn table primitive

**Install:**
- `@tanstack/react-table` (latest v8)

**Add shadcn component:**
- `npx shadcn@latest add table` → creates `src/components/ui/table.tsx`

**Verify:** `npm run build` passes.

### Task 2: Create DataTable component

**Create `src/components/shared/DataTable.tsx`:**

Generic, reusable data table component wrapping TanStack Table + shadcn Table.

Props:
```typescript
interface DataTableProps<TData> {
  columns: ColumnDef<TData, unknown>[];
  data: TData[];
  // Pagination (server-side)
  pageCount: number;
  pageIndex: number;
  pageSize: number;
  onPaginationChange: (pagination: { pageIndex: number; pageSize: number }) => void;
  // Sorting (server-side)
  sorting: SortingState;
  onSortingChange: OnChangeFn<SortingState>;
  // State
  isLoading?: boolean;
  emptyMessage?: string;
  emptyIcon?: LucideIcon;
}
```

Behavior:
- Renders sortable column headers with chevron indicators
- Shows LoadingState (skeleton rows) when `isLoading` is true
- Shows EmptyState when data array is empty and not loading
- Pagination bar at bottom: "Showing X-Y of Z" + page size selector (10/20/50) + prev/next buttons
- `manualPagination: true` and `manualSorting: true` — all server-driven
- Uses shadcn Table components for markup

### Task 3: Create DataTableColumnHeader component

**Create `src/components/shared/DataTableColumnHeader.tsx`:**

Reusable column header with sort toggle icon. Clicking cycles through: unsorted → asc → desc → unsorted. Shows ArrowUp/ArrowDown/ArrowUpDown icons from lucide.

### Task 4: Create EntityDetailHeader component

**Create `src/components/shared/EntityDetailHeader.tsx`:**

Top section of any entity detail page. Stripe-style layout:

```typescript
interface EntityDetailHeaderProps {
  title: string;        // e.g. "John Smith"
  subtitle?: string;    // e.g. email
  status?: string;      // renders StatusBadge
  avatarUrl?: string;   // optional avatar/logo
  avatarFallback?: string; // initials for fallback
  children?: ReactNode; // action buttons on right side
}
```

Layout: Avatar (or initials circle) | Title + Subtitle + StatusBadge | Actions (right-aligned)

### Task 5: Create CopyableField component

**Create `src/components/shared/CopyableField.tsx`:**

Inline display of a label + value with a copy button that appears on hover. Used for IDs, emails, phone numbers on detail pages.

```typescript
interface CopyableFieldProps {
  label: string;
  value: string;
  mono?: boolean; // monospace for IDs
}
```

### Task 6: Create query params hook for server-driven tables

**Create `src/hooks/use-table-params.ts`:**

Hook that syncs TanStack Table pagination + sorting state with URL search params via TanStack Router. This lets users bookmark filtered/sorted/paged views.

```typescript
function useTableParams(defaults?: { pageSize?: number; sortBy?: string; sortOrder?: 'asc' | 'desc' }) {
  // Returns: { pagination, sorting, onPaginationChange, onSortingChange, searchParams }
  // Reads/writes page, limit, sortBy, sortOrder to URL search params
}
```

## Commit

Single commit: `feat(02-01): shared DataTable, EntityDetailHeader, and CopyableField components`

## Success Criteria

- [ ] `@tanstack/react-table` installed and `src/components/ui/table.tsx` exists
- [ ] DataTable renders with pagination controls and sort headers
- [ ] EntityDetailHeader renders avatar + title + status
- [ ] CopyableField shows label + value + copy button on hover
- [ ] useTableParams hook syncs table state with URL search params
- [ ] `npm run build` passes with no TypeScript errors
