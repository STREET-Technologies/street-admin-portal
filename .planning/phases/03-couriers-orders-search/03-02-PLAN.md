# Plan 03-02: Order Detail Page + Courier Info

## Context

This plan builds the order detail page — the most information-dense page in the admin portal. An order touches users, retailers, couriers, items, payments, delivery, and addresses. The detail page needs to surface all this data in a clear, scannable layout.

**Courier integration:** Since couriers are third-party (Stuart API) with no standalone entity, courier information is displayed as part of the order detail's delivery section. The `deliveryDetails` JSONB on each order contains courier name, phone, photo, vehicle type, and real-time location data. Requirements DETL-03 (courier detail) and LIST-03 (courier list) are addressed by showing courier data within the order context rather than as standalone pages.

**Backend endpoints used:**
- `GET /admin/vendors/:vendorId/orders` — order data includes items, user, vendor
- `GET /admin/users/:userId/orders` — alternative path for user-scoped orders
- No dedicated `GET /admin/orders/:id` endpoint exists. To show a single order's full detail, we use the data already fetched from the list, or look up via vendor/user orders.

## Dependencies

- Plan 03-01: Order types, API functions, query hooks
- Phase 02-01: EntityDetailHeader, CopyableField, StatusBadge
- Phase 01-03: API client

## Requirements Addressed

- DETL-04: Full order detail (items, payment status, delivery status, customer, retailer, courier)
- DETL-03: Courier detail (shown within order delivery section)
- LIST-03: Courier list (deferred — see Courier Section below)
- DETL-05: Status badges on order detail
- DETL-06: Copyable order IDs, customer emails, phones

## Tasks

### Task 1: Extend order types for detail view

**Update `src/features/orders/types.ts`:**

Add `OrderDetailViewModel` that extends `OrderViewModel` with:
```typescript
export interface OrderDetailViewModel extends OrderViewModel {
  // Customer
  customer: {
    id: string | null;
    name: string;
    email: string;
    phone: string;
  };
  // Retailer
  retailer: {
    id: string;
    name: string;
    logo?: string;
  } | null;
  // Items
  items: OrderItemViewModel[];
  // Payment
  payment: {
    status: string;
    method: string;
    amount: string;
    refundedAmount: string | null;
  } | null;
  // Delivery
  delivery: {
    status: string;
    courierName: string | null;
    courierPhone: string | null;
    courierPhoto: string | null;
    vehicleType: string | null;
    trackingUrl: string | null;
    estimatedDelivery: string | null;
  } | null;
  // Address
  shippingAddress: {
    line1: string;
    line2?: string;
    city: string;
    postcode: string;
    country: string;
  } | null;
  // Pricing
  pricing: {
    subtotal: string;
    deliveryFee: string;
    serviceFee: string;
    total: string;
  } | null;
}

export interface OrderItemViewModel {
  id: string;
  productName: string;
  variant: string;
  sku: string;
  quantity: number;
  unitPrice: string;
  totalPrice: string;
  imageUrl: string | null;
  packingStatus: string | null;
}
```

Add `toOrderDetailViewModel(backend: BackendOrder): OrderDetailViewModel` transform function.

### Task 2: Create OrderDetailPage

**Create `src/features/orders/components/OrderDetailPage.tsx`:**

Layout (no tabs — single scrollable page with card sections):
```
[Back button]
[EntityDetailHeader: Order #ST-XXXXX | Status badge | Payment status badge]

[Grid: 2 columns on large screens]
  [Left column]
    [Card: Order Items]
      - Table: product image, name, variant, qty, unit price, total
      - Packing status badge per item if available

    [Card: Payment Details]
      - Status, method, amount, refunded amount

    [Card: Pricing Breakdown]
      - Subtotal, delivery fee, service fee, total

  [Right column]
    [Card: Customer]
      - Name (link to user detail if userId exists), email (copyable), phone (copyable)

    [Card: Retailer]
      - Name (link to retailer detail), logo

    [Card: Delivery]
      - Status, courier name, phone, vehicle type
      - Tracking URL (external link)
      - Estimated delivery time

    [Card: Shipping Address]
      - Formatted address lines
```

Props: `{ orderId: string }`

### Task 3: Create order detail route

**Create `src/app/routes/_authenticated/orders/$orderId.tsx`:**

```typescript
import { createFileRoute } from "@tanstack/react-router";
import { OrderDetailPage } from "@/features/orders/components/OrderDetailPage";

export const Route = createFileRoute("/_authenticated/orders/$orderId")({
  component: OrderDetailRoute,
});

function OrderDetailRoute() {
  const { orderId } = Route.useParams();
  return <OrderDetailPage orderId={orderId} />;
}
```

### Task 4: Update Courier page as delivery-focused view

**Update `src/app/routes/_authenticated/couriers/index.tsx`:**

Since couriers are not standalone entities, replace the placeholder with a helpful message that explains courier data is accessed through order details. Include a link to the orders page.

Alternatively, if we have enough delivery data across orders, show a simple view of recent deliveries with courier info. This depends on what `deliveryDetails` contains across orders.

Pragmatic approach: Update the couriers placeholder to explain that courier information is available within order detail pages, with a link to orders. This honestly communicates the backend limitation without pretending we have data we don't.

## Commit

Single commit: `feat(03-02): order detail page with delivery/courier info`

## Success Criteria

- [ ] OrderDetailPage shows all order sections: items, payment, delivery, customer, retailer, address, pricing
- [ ] Courier info (name, phone, vehicle) displays in delivery card when available
- [ ] Customer name links to user detail, retailer name links to retailer detail
- [ ] Order IDs, emails, phones are copyable
- [ ] Order detail route `/orders/:orderId` works and survives refresh
- [ ] Couriers page explains data is within order details
- [ ] `npm run build` passes with no TypeScript errors
